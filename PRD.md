# PRD: Money Translator (MVP) - 수동 배치 버전

## 1. 프로젝트 개요
**프로젝트명**: Money Translator (경제 뉴스 통역기)

**목표**: 경제 뉴스를 AI가 분석하여 '쉬운 요약'과 '투자 인사이트'를 제공한다.

**핵심 로직**: 매일 아침 07:00(KST)를 기점으로 '오늘의 뉴스'를 갱신하며, 첫 방문자가 버튼을 누르면 분석이 시작되고 이후 방문자는 생성된 결과를 본다.

## 2. 유저 시나리오 (User Flow)
**접속 & 상태 확인**: 유저가 웹페이지에 접속하면 시스템은 현재 시간(KST)과 DB에 저장된 최신 데이터의 날짜를 비교한다.

### Case A: 아직 분석된 데이터가 없을 때 (또는 07:00가 지나서 갱신이 필요할 때)
1. 화면에 "☕️ 오늘의 경제 뉴스를 가져올까요?" 문구와 [오늘 뉴스 보기] 버튼이 노출된다.
2. 유저가 버튼을 클릭한다.
3. Loading UI: "뉴스를 분석하는 중이에요... (약 10~20초 소요)" 문구와 스피너(Spinner)가 뜬다.
4. 백그라운드에서 뉴스 수집 -> AI 요약 -> DB 저장이 진행된다.
5. 완료되면 페이지가 새로고침되며 결과가 보인다.

### Case B: 이미 누군가 생성해 둔 데이터가 있을 때
1. 버튼 없이 즉시 오늘의 뉴스 카드 리스트가 보인다.

**상세 확인**: 뉴스 카드의 '원본 기사 보러가기' 링크를 클릭하여 언론사 페이지로 이동한다.

## 3. 상세 기능 명세 (Specifications)

### 3.1. 시간 및 데이터 관리 규칙 (Business Logic)
- **기준 시간**: 한국 표준시 (KST) 07:00 AM.
- **데이터 유효성 판단**:
  - 현재 시간이 N일 07:00 ~ N+1일 06:59 사이라면, N일자 데이터가 있는지 확인.
  - 데이터가 없으면 -> [분석 요청 버튼] 활성화.
  - 데이터가 있으면 -> [결과 리스트] 노출. (단, 운영시간 내 일일 20회 한도로 [새로고침] 버튼을 통해 최신 뉴스로 갱신 가능)
- **데이터 보존**: DB에는 과거 데이터도 쌓이지만, 프론트엔드(화면)에서는 '현재 유효한 날짜'의 데이터만 필터링해서 보여준다.

### 3.2. 데이터 수집 (Input)
- **소스**: 네이버 뉴스 검색 API
- **수집 항목**:
  - `title`: 기사 제목 (HTML 태그 제거 필요)
  - `originallink`: 기사 원문 URL (없으면 link 사용)
  - `pubDate`: 기사 발행 시간 (화면 노출용, hh:mm 형식으로 변환)
  - `description`: 기사 요약본 (AI 분석용)
- **필터링 규칙**:
  - **우선 타겟 키워드** (이 키워드 포함 뉴스 우선 수집):
    - 단독, 체결, 수주, 인수, 합병, 공시
    - 특징주, 급등, 어닝 서프라이즈, 흑자 전환
    - 세계 최초, FDA 승인, 개발 성공, 정부 발표
  - **제외 키워드** (이 키워드 포함 뉴스 제외):
    - 마감, 시황, 코스피, 코스닥, 환율, 유가
    - 인사, 부고, 동정, 게시판, 캠페인
    - 모집, 개최, 이벤트, 할인, 포토, 영상
    - 오늘의 운세, 날씨, 기자수첩

### 3.3. AI 분석 및 가공 (Process)
- **모델**: Groq (Llama 3.3 70B)
- **Trigger**: 유저가 [오늘 뉴스 보기] 버튼을 클릭했을 때만 1회 실행.
- **프롬프트 요구사항**:
  - 입력된 뉴스 리스트를 분석하여 개별 뉴스로 구조화.
  - 각 뉴스 별 impact(호재/악재/중립), summary(2-3줄 요약) 추출.
  - **투자 인사이트 추출 규칙**:
    - 모호한 표현 금지 (예: "수출 관련주" ❌)
    - 구체적 종목명(Ticker) 명시: KOSPI/KOSDAQ 상장 종목 2~3개 추천
    - 비상장 기업 처리: 상장된 경쟁사 또는 지분 보유 모회사 추천
  - **출력 필드**:
    - `theme`: 관련 테마/업종
    - `stocks`: 주목할 종목 (쉼표 구분)
    - `comment`: AI 코멘트 (왜 이 종목들이 관련 있는지 설명)

### 3.4. 사용자 인터페이스 (UI/UX)

#### 디자인 원칙
1. **명도 대비 규칙**: 배경색과 텍스트 색상의 명도 대비를 충분히 확보한다.
   - 밝은 배경 → 어두운 텍스트 (예: #ffffff 배경, #1a1a1a 텍스트)
   - 어두운 배경 → 밝은 텍스트 (예: #1a1a1a 배경, #ffffff 텍스트)
   - 모든 UI 컴포넌트(버튼, 토스트, 카드 등)에 적용
2. **감성 색상**: 인사이트 박스 색상으로 호재(연한 빨간색), 악재(하늘색), 중립(회색) 사용

#### 화면 구성
- **메인 화면 (Empty State)**:
  - 중앙에 큼지막한 [오늘 뉴스 보기] 버튼 (Primary Color)
  - 버튼 하단에 작은 글씨로 "매일 아침 7시에 갱신됩니다" 안내
- **로딩 화면 (Loading State)**:
  - 화면 중앙에 큰 로딩 아이콘 + 진행률 바
  - 단계별 상태 텍스트 표시 (뉴스 수집 → 분석 → 브리핑 → 저장)
- **결과 화면 (Result State)**:
  - 헤더: "2026-01-29" (날짜만 표시)
  - 마지막 업데이트 시간 표시
  - 뉴스 카드 (박스 형태, 테두리 + 그림자):
    - 번호, 발행 시간 (hh:mm 형식)
    - 제목
    - 인사이트 박스 (호재/악재/중립 라벨, 테마, 종목, AI 코멘트)
    - AI 요약 내용
    - 원본 기사 링크 (텍스트 하이퍼링크)

### 3.5. 새로고침 정책
- **운영시간**: 07:00 ~ 22:00 (KST)
- **하루 새로고침 횟수**: 20회 제한 (세션 기반)
- **새로고침 버튼**: 항상 노출 (횟수 초과 또는 운영시간 외에는 딤 처리)
- **토스트 메시지**: 새로고침 시 "남은횟수 19/20" 형태로 2초간 표시

### 3.6. Streamlit 설정
- **설정 파일**: `.streamlit/config.toml`
- **테마**: 라이트 모드 강제 적용 (다크 모드 대응)
- **툴바**: 최소화 모드 (불필요한 메뉴 숨김)
- **프로젝트 소개 (New)**: 사이드바 상단에 [프로젝트 소개] 버튼 추가. 클릭 시 모달(Dialog)로 포트폴리오용 기술 요약 정보 표시.
- **숨김 처리 (CSS)**:
  - 앵커 링크 (링크 복사 아이콘)
  - 페이지 푸터 (Made with Streamlit)
  - 사이드바 하단 여백 제거

## 4. 데이터베이스 스키마 (SQLite)

### 테이블: `daily_news`
| 컬럼 | 타입 | 설명 |
|------|------|------|
| id | Integer (PK) | 고유 ID |
| batch_date | String | 기준일자 (YYYY-MM-DD) |
| title | Text | 기사 제목 |
| url | Text | 기사 링크 |
| pub_date | Text | 발행 시간 |
| summary | Text | AI 요약 |
| sentiment | Text | 호재/악재/중립 |
| keywords | Text | 관련 종목 (JSON) |
| created_at | Datetime | 저장 시간 (UTC) |

### 테이블: `daily_briefing`
| 컬럼 | 타입 | 설명 |
|------|------|------|
| id | Integer (PK) | 고유 ID |
| batch_date | String | 기준일자 (YYYY-MM-DD) |
| mood | Text | 시장 분위기 (맑음/흐림/변동성) |
| mood_label | Text | 분위기 라벨 (호재 우세/악재 우세/혼조세) |
| summary | Text | 3-4문장 요약 |
| hot_keywords | Text | 핫 키워드 (쉼표 구분) |
| created_at | Datetime | 저장 시간 (UTC) |

## 💡 개발자(Antigravity) 팁

### 코드 작성 시 주의사항
1. **명도 대비**: 모든 텍스트는 배경과 충분한 명도 대비를 확보할 것
2. **시간대 처리**: SQLite는 UTC로 저장하므로, 화면 표시 시 KST(+9시간) 변환 필요
3. **Streamlit 상태 관리**: `st.session_state`로 새로고침 횟수, 트리거 등 관리

